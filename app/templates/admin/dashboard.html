{% extends "base.html" %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-screen bg-gray-50">
    <h1 class="text-3xl font-bold mb-8 text-blue-700">Admin Dashboard</h1>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-6xl">
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">User Management</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for user in users %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">{{ user.username }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">{{ user.email }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex px-2 py-1 rounded text-xs font-semibold {{ 'bg-blue-100 text-blue-800' if user.role == 'admin' else 'bg-gray-100 text-gray-800' }}">
                                    {{ user.role }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {% if user != current_user %}
                                <a href="{{ url_for('admin.toggle_role', id=user.id) }}" class="text-blue-600 hover:underline mr-2">Toggle Role</a>
                                <a href="{{ url_for('admin.delete_user', id=user.id) }}" class="text-red-600 hover:underline" onclick="return confirm('Are you sure you want to delete this user?')">Delete</a>
                                {% else %}
                                <span class="text-gray-400">(You)</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">Survey Management</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-100">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Industry</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Success</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for survey in surveys %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">{{ survey.created_at.strftime('%Y-%m-%d') }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">{{ survey.author.username }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">{{ survey.industry_type }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex px-2 py-1 rounded text-xs font-semibold {{ 'bg-green-100 text-green-800' if survey.success else 'bg-red-100 text-red-800' }}">
                                    {{ 'Yes' if survey.success else 'No' }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <a href="{{ url_for('admin.delete_survey', id=survey.id) }}" class="text-red-600 hover:underline" onclick="return confirm('Are you sure you want to delete this survey?')">Delete</a>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 md:col-span-2">
            <h2 class="text-xl font-semibold mb-4">Model Management</h2>
            <p class="mb-4 text-gray-700">This action will delete the trained machine learning model and scaler files from the server. The model will be retrained with synthetic data on the next prediction request if no real data is available.</p>
            <form action="{{ url_for('admin.delete_model') }}" method="POST" onsubmit="return confirm('Are you sure you want to delete the trained model? This action cannot be undone.');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Delete Trained Model</button>
            </form>
        </div>
    </div>
</div>
{% endblock %} 